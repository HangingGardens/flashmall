import{_ as z,d as E,u as F,C as J,j as L,x as O,V as q,W as G,D as W,i as H,y as i,c as K,z as r,a,t as n,k as o,A as c,E as d,e as x,J as Q,G as k,o as h,l as X,n as Y,p as Z,f as ee}from"./index-27cd35bf.js";import{_ as te}from"./MCOIN-c941fc3b.js";import{_ as oe}from"./avatarBig-f2d754bd.js";import{B as ae}from"./BackIcon-9938d35a.js";import{u as y}from"./index-95f4a229.js";const C=m=>(Z("data-v-4c74b6a1"),m=m(),ee(),m),se={class:"bg-gradient-to-b from-color4 to-color9 px-4 pt-4"},ne={class:"mt-6 text-lg bg-white px-9 py-3.5 rounded-t-xl"},le={class:"font-bold"},re={class:"text-[#D1C2A7]"},ie={class:"py-6 rounded-b-xl linear-bg text-center px-10"},ce=C(()=>a("img",{src:te,class:"w-6 h-6 absolute top-0 right-0"},null,-1)),de={class:"text-[#B4B4B4] mt-5"},me={class:"border-b border-solid border-[#e1e1e1] text-3xl relative mt-2.5 pb-5"},pe={class:"bg-white w-full mt-2.5 rounded-xl p-2.5 flex items-center justify-between text-xs"},ue=C(()=>a("img",{class:"bottom-img absolute bottom-0 left-4",src:oe},null,-1)),be={class:"p-2.5 pb-[150px] remark-bpx"},fe={class:"relative text-center mb-2.5"},_e=E({setup(m){F();const u=J(),{merchantDiscounts:B,tradeContributeSelfRate:S,trade:V}=L(),[b,f]=y(!1),[w,p]=y(!1),t=O({storeAddress:"",amount:null,balance:null,ratio:0,remark:null,hash:"",pointSelfRate:0,allowance:0}),$=q(),A=async e=>{t.ratio=await B(e)},R=e=>{e=JSON.parse(e),t.storeAddress=e.address,A(e.address)},D=async()=>{t.balance=await(await u).balanceOf()},I=async()=>{t.pointSelfRate=await S()};G(()=>$.query.params,e=>{try{R(e)}catch(s){console.log(s)}},{immediate:!0,deep:!0});const M=W(()=>t.allowance>t.amount),g=async()=>{const e=await(await u).allowance(k.flashMall);t.allowance=e.result},N=async()=>{p(!0),(await(await u).approve(k.flashMall)).success&&await g(),p(!1)},P=async()=>{p(!0);const e=await V(t.storeAddress,t.amount);p(!1),e.success&&console.log(e)};return H(()=>{D(),I(),g()}),(e,s)=>{const U=i("VanField"),v=i("van-icon"),_=i("VanButton"),T=i("van-field"),j=i("van-popup");return h(),K("div",se,[r(ae,{class:"text-white/90"}),a("header",ne,[a("div",le,n(o(X)(o(t).storeAddress)),1),a("div",re,n(e.$t("common.rebate")+o(t).ratio*100)+"%",1)]),a("div",ie,[a("div",null,n(e.$t("bill.payAmount")),1),r(U,{modelValue:o(t).amount,"onUpdate:modelValue":s[0]||(s[0]=l=>o(t).amount=l),placeholder:o(t).balance,"input-align":"center",type:"number",class:"border-b border-solid border-[#e1e1e1] text-3xl relative mt-7"},{"right-icon":c(()=>[ce]),_:1},8,["modelValue","placeholder"]),a("div",de,n(e.$t("order.preScore")),1),a("div",me,n(o(Y)(o(t).amount*o(t).ratio*o(t).pointSelfRate)),1),a("div",pe,[a("div",null,n(e.$t("order.remark")),1),a("div",{class:"flex-1 text-right line-clamp-1 text-[#D1C2A7]",onClick:s[1]||(s[1]=l=>o(f)(!0))},[d(n(o(t).remark?o(t).remark:e.$t("order.noRemark"))+" ",1),r(v,{name:"arrow"})])]),o(M)?(h(),x(_,{key:1,class:"block w-full mt-1 h-[40px] btn-orange btn-shadow text-white",onClick:P,loading:o(w),disabled:!o(t).amount||+o(t).amount>+o(t).balance},{default:c(()=>[d(n(e.$t("common.pay")),1)]),_:1},8,["loading","disabled"])):(h(),x(_,{key:0,class:"block w-full mt-1 h-[40px] btn-orange btn-shadow text-white",onClick:N,loading:o(w)},{default:c(()=>[d(n(e.$t("common.approve")),1)]),_:1},8,["loading"]))]),ue,r(j,{show:o(b),"onUpdate:show":s[5]||(s[5]=l=>Q(b)?b.value=l:null),position:"bottom",round:"",style:{"text-align":"center"}},{default:c(()=>[a("div",be,[a("div",fe,[d(n(e.$t("common.pay"))+" ",1),a("div",{class:"absolute right-0 bottom-[-2px] text-lg",onClick:s[2]||(s[2]=l=>o(f)(!1))},[r(v,{name:"cross"})])]),r(T,{modelValue:o(t).remark,"onUpdate:modelValue":s[3]||(s[3]=l=>o(t).remark=l),rows:"5",autosize:"",type:"textarea",maxlength:"200",placeholder:e.$t("order.remarkDes"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),r(_,{class:"mb-[50px] inline-block btn-orange btn-shadow w-[150px] h-[40px] text-white",onClick:s[4]||(s[4]=l=>o(f)(!1))},{default:c(()=>[d(n(e.$t("common.confirm")),1)]),_:1})]),_:1},8,["show"])])}}}),ke=z(_e,[["__scopeId","data-v-4c74b6a1"],["__file","/Users/wangkeai/work/xueyan/flashmall/flashmall-dapp/src/view/bill/Pay.vue"]]);export{ke as default};
