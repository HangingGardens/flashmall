import{_ as k,d as A,o as d,c as p,a as e,t,y as c,z as n,E as l,F as K,a6 as Q,C as W,V as X,Y as S,h as g,D as Z,i as ee,k as r,A as f,m as U,e as q,J as se,G as T,T as te,a5 as oe}from"./index-27cd35bf.js";import{_ as ae}from"./MCOIN-c941fc3b.js";import{q as ne}from"./address-f6a122f5.js";import{b as re}from"./goods-602bd070.js";import{c as le,d as de,e as ie,p as ce}from"./order-ebc8cfc6.js";import{u as ue}from"./useSelectAddress-cd186f38.js";import{u as me}from"./useLoading-173fb0c3.js";const fe=""+new URL("../images/Vector-arrow-back-ad96c6d5.svg",import.meta.url).href,pe={class:"bg-white p-2.5 rounded-lg flex justify-between items-baseline"},_e={key:0},ve={class:"text-base font-semibold overflow-ellipsis line-clamp-2"},he={class:"opacity-60 mt-1"},we={key:1},ge=e("img",{src:fe,alt:"",class:"w-2 rotate-180"},null,-1),xe=A({props:{defaultAddress:{type:null,required:!0}},setup(o){return(u,_)=>(d(),p("div",pe,[o.defaultAddress?(d(),p("div",_e,[e("div",ve,t(`${o.defaultAddress.provinceName}${o.defaultAddress.cityName}${o.defaultAddress.countyName}${o.defaultAddress.detailInfo}`),1),e("div",he,t(o.defaultAddress.userName)+"\xA0"+t(o.defaultAddress.telNumber),1)])):(d(),p("div",we,t(u.$t("order.setAddress")),1)),ge]))}}),ye=k(xe,[["__file","/Users/wangkeai/work/xueyan/flashmall/flashmall-dapp/src/view/order/components/AddressInfo.vue"]]),be=""+new URL("../images/mall-5c3adc05.svg",import.meta.url).href,$e={class:"flex-center-bw"},ke={class:"w-[80px] h-[80px] rounded-xl overflow-hidden mr-2"},Ae={class:"flex-1 flex justify-between flex-col min-h-[80px]"},Ie={class:"line-clamp-1"},Ce={class:"opacity-60 line-clamp-2"},Ne={class:"flex-center-bw"},Ve={class:"flex-center text-primary"},Be=e("img",{src:ae,class:"w-3 h-3 mr-1"},null,-1),Oe={class:"flex-center opacity-60"},Se=l(t(1)),Le=A({props:{goods:{type:null,required:!0}},setup(o){return(u,_)=>{const I=c("VanImage"),C=c("van-icon");return d(),p("div",$e,[e("div",ke,[n(I,{src:o.goods.goodsPic,class:"w-full h-full object-cover overflow-hidden"},null,8,["src"])]),e("div",Ae,[e("section",null,[e("div",Ie,t(o.goods.goodsName),1),e("div",Ce,t(o.goods.goodsDesc),1)]),e("section",Ne,[e("div",Ve,[Be,l(" "+t(o.goods.price)+"Mcoin",1)]),e("div",Oe,[n(C,{name:"cross"}),Se])])])])}}}),Re=k(Le,[["__file","/Users/wangkeai/work/xueyan/flashmall/flashmall-dapp/src/view/order/components/OrderGoods.vue"]]),De={class:"flex-start mt-2.5"},Ge=e("img",{src:be,class:"w-4 mr-1"},null,-1),Ue={class:"bg-white mt-2.5 rounded-xl p-2.5"},qe=A({props:{orderInfo:{type:null,required:!0}},setup(o){return(u,_)=>(d(),p(K,null,[e("div",De,[Ge,e("div",null,t(o.orderInfo.stores.storeName||"-"),1)]),e("div",Ue,[n(Re,{goods:o.orderInfo.goods,class:"mb-2.5 last:mb-0"},null,8,["goods"])])],64))}}),Te=k(qe,[["__file","/Users/wangkeai/work/xueyan/flashmall/flashmall-dapp/src/view/order/components/OrderGoodsBox.vue"]]);const je={key:0,class:"p-2.5"},Fe={class:"text-xl font-semibold"},Me={class:"bg-white mt-2.5 rounded-xl p-2.5 flex items-center justify-between"},Ee={class:"flex-1"},Pe={class:"bg-white mt-2.5 rounded-xl p-2.5"},ze={class:"flex items-baseline justify-between mt-1"},He={class:"text-right"},Je={class:"text-base font-semibold"},Ye={class:"flex flex-col items-center my-[50px]"},Ke={class:"p-2.5 pb-[150px]"},Qe={class:"relative text-center mb-2.5"},We=A({setup(o){const{loadingToggle:u}=me(),{getAddress:_,setAddress:I}=ue(),{submit:C}=Q(),L=W(),j=X(),[N,V]=S(!1),[F,M]=S(!0),[R,x]=S(!1),B=g([]),y=g(),v=g(),D=g(0),h=g(""),E=Z(()=>D.value>0),P=async()=>{if(_()){y.value=_(),I(null);return}const s=await ne();!s.success||(B.value=s.data,y.value=B.value.find(a=>a.isDefault===1)||B.value[0])},z=async()=>{const s=await re(+j.query.id);s.success,v.value=s.data},G=async()=>{const s=await(await L).allowance(T.order);D.value=s.result},H=async()=>{x(!0),(await(await L).approve(T.order)).success&&await G(),x(!1)},J=async()=>{x(!0);try{await le({goodsId:v.value.goods.id,number:1}),await de({type:1});const s=await ie({type:1,addressId:y.value.id,postscripts:[{postscript:h.value,storeId:v.value.stores.id}]});if(!s.success)return;const{allOrderId:a,merchants:b,discounts:$,amounts:w}=s.data,m=await C(b,$,w);m.success||te(m.result.reason||"Fail");const O=await ce({allOrderId:a,hash:m.result.blockHash,ids:m.result.events[0].args.id.toString()});console.log(O)}finally{x(!1)}},Y=async()=>{u(!0),await P(),await z(),await G(),u(!1),M(!1)};return ee(()=>{Y()}),(s,a)=>{const b=c("van-icon"),$=c("h"),w=c("VanButton"),m=c("van-field"),O=c("van-popup");return r(F)?U("v-if",!0):(d(),p("div",je,[e("header",Fe,t(s.$t("order.submitOrder")),1),n(ye,{class:"mt-2.5",defaultAddress:y.value,onClick:a[0]||(a[0]=i=>r(oe)("/userAddress"))},null,8,["defaultAddress"]),n(Te,{orderInfo:v.value},null,8,["orderInfo"]),e("div",Me,[e("div",Ee,t(s.$t("order.remark")),1),e("div",{class:"flex-1 text-right line-clamp-1 opacity-60",onClick:a[1]||(a[1]=i=>r(V)(!0))},[l(t(h.value?h.value:s.$t("order.noRemark"))+" ",1),n(b,{name:"arrow"})])]),e("div",Pe,[n($,null,{default:f(()=>[l(t(s.$t("order.priceDetail")),1)]),_:1}),e("div",ze,[n($,{class:"opacity-60"},{default:f(()=>[l(t(s.$t("order.total")),1)]),_:1}),e("div",He,[e("div",Je,t(v.value.goods.price)+"Mcoin",1),U(' <div class="opacity-60">\u9884\u8BA1\u83B7\u5F97444\u8D21\u732E\u503C</div> ')])])]),e("div",Ye,[r(E)?(d(),q(w,{key:1,class:"btn-orange btn-shadow w-[150px] h-[40px] text-white",loading:r(R),onClick:J},{default:f(()=>[l(t(s.$t("common.pay")),1)]),_:1},8,["loading"])):(d(),q(w,{key:0,class:"btn-orange btn-shadow w-[150px] h-[40px] text-white",loading:r(R),onClick:H},{default:f(()=>[l(t(s.$t("common.approve")),1)]),_:1},8,["loading"]))]),n(O,{show:r(N),"onUpdate:show":a[5]||(a[5]=i=>se(N)?N.value=i:null),position:"bottom",round:"",style:{"text-align":"center"}},{default:f(()=>[e("div",Ke,[e("div",Qe,[l(t(s.$t("order.submitOrder"))+" ",1),e("div",{class:"absolute right-0 bottom-[-2px] text-lg",onClick:a[2]||(a[2]=i=>r(V)(!1))},[n(b,{name:"cross"})])]),n(m,{modelValue:h.value,"onUpdate:modelValue":a[3]||(a[3]=i=>h.value=i),rows:"5",autosize:"",type:"textarea",maxlength:"200",placeholder:s.$t("order.remarkDes"),"show-word-limit":""},null,8,["modelValue","placeholder"])]),n(w,{class:"mb-[50px] inline-block btn-orange btn-shadow w-[150px] h-[40px] text-white",onClick:a[4]||(a[4]=i=>r(V)(!1))},{default:f(()=>[l(t(s.$t("common.confirm")),1)]),_:1})]),_:1},8,["show"])]))}}}),ns=k(We,[["__scopeId","data-v-78097d38"],["__file","/Users/wangkeai/work/xueyan/flashmall/flashmall-dapp/src/view/order/SubmitOrder.vue"]]);export{ns as default};
